# Output Files Summary - v_universe_sanity Experiment

## Overview
This document summarizes all output files generated by the IntentFlow AI pipeline for the `v_universe_sanity` experiment.

**Total Size:** ~53MB  
**Generated by:** Training, Scoring, Backtest, and Sanity pipelines

---

## üì¶ Model Artifacts

### `lgb.pkl` (16.0 MB)
**Purpose:** Serialized trained model bundle  
**Contains:**
- `models`: Dictionary of LightGBM models (overall + regime-specific)
- `regime_classifier`: Market regime classifier instance
- `feature_columns`: List of feature names used in training
- `meta_model`: Optional meta-labeling model
- `meta_feature_columns`: Features for meta-model
- `meta_config`: Meta-labeling configuration

**Usage:** Loaded by scoring pipeline to generate new signals

---

## üìä Training Outputs

### `preds.csv` (25.1 MB)
**Purpose:** All model predictions on training data  
**Rows:** ~407,000 predictions  
**Columns:**
- `date`: Prediction date
- `ticker`: Stock ticker
- `label`: Binary label (0/1)
- `excess_fwd`: Forward excess return
- `proba`: Model probability prediction

**Usage:** Used for evaluation, SHAP background data, and analysis

### `metrics.json` (16.6 KB)
**Purpose:** Comprehensive model performance metrics  
**Structure:**
- `overall`: Metrics across all data
- `train`: Training set metrics
- `valid`: Validation set metrics
- `test`: Test set metrics
- `by_regime`: Metrics broken down by market regime (bull/bear)
- `purged_cv`: Cross-validation fold results

**Metrics Included:**
- ROC AUC, PR AUC
- Information Coefficient (IC), Rank IC
- Precision@10, Precision@20
- Hit rates at various thresholds
- Hit rate curves

**Current Performance:**
- Overall ROC AUC: 0.79
- Overall IC: 0.40
- Overall Rank IC: 0.45

### `feature_importance.csv` (0.8 KB)
**Purpose:** Feature importance scores from LightGBM  
**Columns:**
- `feature`: Feature name
- `importance`: Importance score

**Usage:** Identify most predictive features for model interpretation

### `universe_snapshot.csv` (10.6 MB)
**Purpose:** Snapshot of training universe  
**Contains:**
- Ticker counts by date
- Universe membership information
- Date ranges for each ticker

**Usage:** Data scope validation and audit trail

### `metrics_report.md` (17.5 KB)
**Purpose:** Human-readable performance report  
**Contains:**
- Metrics tables by split
- Diagnostic plot references
- Backtest summary
- Cost sweep results
- Sanity check results

**Usage:** Quick review of experiment results

---

## üéØ Live Signal Outputs

### `top_signals.csv` (196.4 KB)
**Purpose:** Live trading signals with full SHAP explanations  
**Rows:** ~90 signals (latest 60-day window)  
**Columns:**
- `date`: Signal date
- `ticker`: Stock ticker
- `sector`: Sector classification
- `proba`: Model probability (0-1)
- `rank`: Signal rank (1 = highest probability)
- `top_features`: JSON array of top 10 contributing features
  - Each feature includes: name, value, shap_contribution, abs_contribution
- `rationale`: Human-readable explanation
  - Format: "Boosted by: [features]. Suppressed by: [features]"
- `shap_values`: JSON object mapping feature names to SHAP contributions

**Example Rationale:**
```
Boosted by: technical__macd, momentum__ret_10d, atr__atr_pct_14. 
Suppressed by: technical__ema_20, sector_relative__sector_rank_pct, technical__ema_50
```

**Usage:** 
- Primary output for live trading
- Dashboard visualization
- Position-level decision making
- Audit and compliance

**Key Features:**
- ‚úÖ Position-level interpretability
- ‚úÖ SHAP-based feature attribution
- ‚úÖ Human-readable rationale
- ‚úÖ Full diagnostic information

---

## üí∞ Backtest Outputs

### `bt_summary.json` (1.0 KB)
**Purpose:** Backtest performance summary  
**Metrics:**
- `CAGR`: Compound Annual Growth Rate
- `Sharpe`: Sharpe ratio (risk-adjusted returns)
- `maxDD`: Maximum drawdown
- `win_rate`: Percentage of profitable trades
- `turnover`: Portfolio turnover
- `avg_hold_days`: Average holding period
- `avg_positions`: Average number of positions
- `cost_model`: Cost model configuration
- `risk_filters`: Risk filter settings applied

**Current Results:**
- CAGR: 0.0% (no trades in current backtest)
- Sharpe: 0.0
- Max DD: 0.0%
- Win Rate: 0.0%

**Note:** Current backtest shows no trades due to limited data. Results improve with full universe.

### `bt_equity.csv` (0.0 KB)
**Purpose:** Portfolio equity curve over time  
**Columns:**
- `date`: Date
- `equity`: Portfolio value

**Usage:** Visualization of portfolio performance over time

### `bt_trades.csv` (0.1 KB)
**Purpose:** Individual trade log  
**Columns:**
- `date_in`: Entry date
- `date_out`: Exit date
- `ticker`: Stock ticker
- `entry_px`: Entry price
- `exit_px`: Exit price
- `gross_ret`: Gross return (before costs)
- `net_ret`: Net return (after costs)

**Usage:** Trade analysis, win/loss patterns, holding period analysis

### `cost_sweep.csv` (0.4 KB)
**Purpose:** Backtest results across different cost models  
**Columns:**
- Cost model name
- Total bps (basis points)
- Sharpe ratio
- CAGR
- Max drawdown

**Cost Models Tested:**
- `realistic`: 26.1 bps (brokerage + STT + stamp duty + exchange + SEBI + GST)
- `sweep_10bps`: 10 bps
- `sweep_25bps`: 25 bps
- `sweep_50bps`: 50 bps
- `sweep_75bps`: 75 bps

**Usage:** Sensitivity analysis for transaction costs

---

## üî¨ Sanity Check Outputs

### `sanity/null_label_summary.json` (0.2 KB)
**Purpose:** Null-label backtest results  
**Contains:**
- Sharpe ratio with random labels (should be ~0)
- IC with random labels (should be ~0)
- Rank IC with random labels (should be ~0)

**Usage:** Validates no data leakage - random labels should produce no edge

**Expected Results:**
- Sharpe: ~0.0
- IC: ~0.0
- Rank IC: ~0.0

**Current Results:**
- Sharpe: -1.851 (negative as expected for random)
- IC: 0.006 (near zero ‚úì)
- Rank IC: 0.005 (near zero ‚úì)

### `sanity/null_label_preds.csv`
**Purpose:** Predictions using null (random) labels  
**Usage:** Detailed analysis of null-label backtest

---

## üìà File Size Breakdown

| Category | Files | Total Size |
|----------|-------|------------|
| Model | 1 | 16.0 MB |
| Training | 5 | ~36.5 MB |
| Scoring | 1 | 196.4 KB |
| Backtest | 4 | ~1.5 KB |
| Sanity | 2 | ~0.2 KB |
| **Total** | **13** | **~53 MB** |

---

## üîÑ Pipeline Flow

```
Training Pipeline
  ‚Üì
lgb.pkl, preds.csv, metrics.json, feature_importance.csv, universe_snapshot.csv
  ‚Üì
Scoring Pipeline (uses lgb.pkl + preds.csv for SHAP background)
  ‚Üì
top_signals.csv (with SHAP explanations)
  ‚Üì
Backtest Pipeline (uses top_signals.csv or preds.csv)
  ‚Üì
bt_summary.json, bt_equity.csv, bt_trades.csv, cost_sweep.csv
  ‚Üì
Sanity Pipeline (uses training data + backtest results)
  ‚Üì
sanity/null_label_*.json, metrics_report.md
```

---

## üéØ Key Outputs for Production

### For Live Trading:
1. **`top_signals.csv`** - Primary signal file with SHAP explanations
2. **`lgb.pkl`** - Model for scoring new data

### For Monitoring:
1. **`metrics.json`** - Model performance tracking
2. **`bt_summary.json`** - Backtest performance
3. **`metrics_report.md`** - Human-readable summary

### For Audit:
1. **`top_signals.csv`** - Full SHAP explanations for each signal
2. **`sanity/null_label_summary.json`** - Leakage validation
3. **`universe_snapshot.csv`** - Data scope documentation

---

## üìù Notes

- All CSV files use JSON strings for complex data types (lists, dicts)
- SHAP explanations require `preds.csv` or `train.parquet` for background data
- Backtest results are minimal due to limited test data (smoke test data)
- Full production runs will generate larger files with more signals and trades

---

**Generated:** 2025-11-17  
**Experiment:** v_universe_sanity  
**Pipeline Version:** Latest with SHAP explanations

